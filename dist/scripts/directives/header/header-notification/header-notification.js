"use strict";angular.module("sbAdminApp").directive("headerNotification",function(){return{templateUrl:"scripts/directives/header/header-notification/header-notification.html",restrict:"E",controller:["$scope","Auth","Advertiser","$state",function($scope,Auth,Advertiser,$state){function initNotification(){Advertiser.getNotification().then(function(res){var retVal=res.data.notifications;$scope.notifies=retVal.filter(function(val){return!val.seen})})}Advertiser.getUserInfo().then(function(res){var retVal=res.data;retVal.success&&(Auth.setUserdata(retVal.advertiser),$scope.userName=retVal.advertiser.userName)}),$scope.logout=function(){Auth.logout(),$state.go("login")},initNotification(),$scope.getBeforeDay=function(item){var dt=moment(item.dtStamp),curDt=moment(),dif=moment.utc(moment(curDt,"DD/MM/YYYY HH:mm:ss").diff(moment(dt,"DD/MM/YYYY HH:mm:ss"))).format("HH");return parseInt(dif)<24?"Today":parseInt(dif)<48?"Yesterday":parseInt(dif)/24+"Days ago"},$scope.setSeen=function(item){Advertiser.setNotiStatus(item.notificationId).then(function(res){res.data.success&&initNotification()})}}],replace:!0}});